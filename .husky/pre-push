
# Check if pushing to main branch
protected_branch='main'
current_branch=$(git symbolic-ref HEAD | sed 's!refs/heads/!!')

if [ "$current_branch" = "$protected_branch" ]; then
    echo "üîí Pushing to main branch - running additional checks..."
    
    # Final security scan
    echo "Running final security scan..."
    sensitive_files=$(find . \( -name "*.env" -o -name "*.env.local" -o -name "*.env.production" -o -name "*.key" -o -name "*.pem" \) | grep -v node_modules | grep -v .git)
    if [ -n "$sensitive_files" ]; then
        echo "‚ùå Sensitive files detected! Remove before pushing to main."
        echo "$sensitive_files"
        exit 1
    fi
    
    # Check for large files (excluding git and node_modules)
    large_files=$(find . -size +10M -type f | grep -v node_modules | grep -v .git)
    if [ -n "$large_files" ]; then
        echo "‚ùå Large files detected! Consider using Git LFS."
        echo "$large_files"
        exit 1
    fi
    
    echo "‚úÖ All pre-push checks passed"
fi